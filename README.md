# Clinician Report

<p align="center">
  <strong>Clinician-Facing Dashboard for Mental Health Assessment Review</strong>
</p>

<p align="center">
  <a href="#overview">Overview</a> ‚Ä¢
  <a href="#features">Features</a> ‚Ä¢
  <a href="#architecture">Architecture</a> ‚Ä¢
  <a href="#getting-started">Getting Started</a> ‚Ä¢
  <a href="#deployment">Deployment</a> ‚Ä¢
  <a href="#project-structure">Project Structure</a>
</p>

---

## Overview

**Clinician Report** is a secure, feature-rich dashboard designed for mental health clinicians to review, analyze, and manage patients. The platform provides comprehensive patient profiles, AI-generated clinical insights, interactive data visualizations, and PDF report generation capabilities.

This application is part of the Integrative Psych Assessment Platform and works in conjunction with:

- **`intake-assessment-v2`** - Patient-facing intake portal where assessments are completed and patient activities are logged
- **`intake-analysis`** - Backend AI services for transcription, sentiment analysis, and clinical insights

### Key Features

- üë• **Patient Search & Management** - Search and filter patients by clinician, date, and name
- üìä **Interactive Reports** - Comprehensive patient profiles with visual data presentations
- üß† **AI Clinical Insights** - Action items and potential diagnoses generated by GPT-5
- üìà **Scale Visualizations** - Radar charts and score breakdowns for psychological assessments
- üìÑ **PDF Export** - Generate and download formatted assessment reports
- üí≠ **Sentiment Analysis** - View emotional tone analysis of patient narratives
- üìù **Treatment Planning** - AI-assisted treatment recommendations
- üéôÔ∏è **Audio Playback** - Listen to patient voice recordings with transcriptions

---

## Features

### Patient Dashboard

The search page provides an at-a-glance view of all patients:

- **Filtering** by assigned clinician
- **Sorting** by name, date, or submission status
- **Quick Preview** of patient demographics and submission status
- **Direct Link** to detailed patient reports

### Patient Report Sections

Each patient report includes:

| Section            | Description                                    |
| ------------------ | ---------------------------------------------- |
| **At a Glance**    | Quick summary cards with key patient info      |
| **Profile**        | Demographics, contact info, and background     |
| **Medical**        | Medical history, medications, and conditions   |
| **History**        | Family history, trauma, and developmental info |
| **Story**          | Patient's narrative with audio playback        |
| **Scales**         | Assessment scores with visualizations          |
| **Journals**       | Patient mood journal entries                   |
| **Treatment Plan** | AI-generated action items and diagnoses        |
| **Learn**          | Psychoeducation module progress                |

### Assessment Scales Supported

#### Adult Scales

| Scale      | Full Name                      | Scoring                   |
| ---------- | ------------------------------ | ------------------------- |
| PHQ-9      | Patient Health Questionnaire-9 | 0-27 (Depression)         |
| GAD-7      | Generalized Anxiety Disorder-7 | 0-21 (Anxiety)            |
| ACE        | Adverse Childhood Experiences  | 0-10 (Trauma)             |
| Resilience | ACE Resilience Score           | 0-14 (Protective factors) |
| PSS-4      | Perceived Stress Scale-4       | 0-16 (Stress)             |
| ASRS-5     | Adult ADHD Self-Report         | 0-24 (ADHD)               |
| PC-PTSD-5  | Primary Care PTSD Screen       | 0-5 (PTSD)                |
| CRAFFT     | Substance Use Screening        | 0-6 (Substance risk)      |

#### Child Scales

| Scale     | Full Name                 | Scoring                   |
| --------- | ------------------------- | ------------------------- |
| SCARED    | Screen for Child Anxiety  | Multi-subscale            |
| SNAP-IV   | ADHD Rating Scale         | Inattention/Hyperactivity |
| C-SSRS    | Columbia Suicide Severity | Risk assessment           |
| DISC-Teen | Diagnostic Interview      | Behavioral screening      |

### AI-Powered Features

#### Clinical Insights

- **Action Items** - Recommended next steps organized by category:
  - Interview questions to explore
  - Collateral interviews to conduct
  - Additional psychological scales
  - Lab tests and medical evaluations
  - Specialist referrals
  - Digital monitoring options

#### Potential Diagnoses

- Up to 3 diagnostic considerations per DSM-5-TR
- Rule-in and rule-out criteria
- Clinical reasoning chain
- Supporting evidence from patient data

#### Sentiment Analysis

- Sentence-by-sentence emotional analysis
- Positive/Neutral/Negative breakdown
- Field-specific sentiment visualization

---

## Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          CLINICIAN-REPORT                                ‚îÇ
‚îÇ                      (Next.js 15 + React 19)                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                         PAGES (App Router)                          ‚îÇ ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /search         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Patient search & list         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /report/[patientId]  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Patient report layout         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚îú‚îÄ‚îÄ /           ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Overview (At a Glance)          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚îú‚îÄ‚îÄ /scales     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Assessment scale scores         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚îú‚îÄ‚îÄ /journals   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Patient mood journals           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚îú‚îÄ‚îÄ /treatment-plan ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ AI insights & diagnoses         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚îî‚îÄ‚îÄ /learn      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Psychoeducation progress        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /analysis         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Batch analysis tools            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                           COMPONENTS                                ‚îÇ ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Report/                                                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ PatientReportClient.tsx  ‚îÄ‚îÄ‚îÄ Main report view                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ ReportHeader.tsx         ‚îÄ‚îÄ‚îÄ Patient header with actions      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ TopBlocks.tsx            ‚îÄ‚îÄ‚îÄ Summary blocks grid              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Cards.tsx                ‚îÄ‚îÄ‚îÄ Data display cards               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ DetailPanels.tsx         ‚îÄ‚îÄ‚îÄ Expandable detail panels         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ RadarChart.tsx           ‚îÄ‚îÄ‚îÄ Scale score visualization        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ ui.tsx                   ‚îÄ‚îÄ‚îÄ Shared UI components             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ScaleDetailDrawer.tsx        ‚îÄ‚îÄ‚îÄ Scale breakdown drawer           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  AssessmentReportPDFAdult.tsx ‚îÄ‚îÄ‚îÄ PDF generation (adult)           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  AssessmentReportPDFChild.tsx ‚îÄ‚îÄ‚îÄ PDF generation (child)           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Garden/                      ‚îÄ‚îÄ‚îÄ Wellness visualization           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  WeatherWidget.tsx            ‚îÄ‚îÄ‚îÄ Mood weather display             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                          API ROUTES                                 ‚îÇ ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/clinician/patients      ‚îÄ‚îÄ‚îÄ List patients for clinician      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/clinician/patients/[id] ‚îÄ‚îÄ‚îÄ Get specific patient profile     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/clinician/scales        ‚îÄ‚îÄ‚îÄ Get assessment scale data        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/clinician/insights      ‚îÄ‚îÄ‚îÄ Trigger/fetch AI insights        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/clinician/journal       ‚îÄ‚îÄ‚îÄ Get patient journal entries      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/sentiment               ‚îÄ‚îÄ‚îÄ Trigger sentiment analysis       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/summarize               ‚îÄ‚îÄ‚îÄ Trigger profile summarization    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/transcribe              ‚îÄ‚îÄ‚îÄ Trigger audio transcription      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/pdf/download            ‚îÄ‚îÄ‚îÄ Generate PDF report              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  /api/audio                   ‚îÄ‚îÄ‚îÄ Stream audio files               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚îÇ
                                   ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ         EXTERNAL SERVICES             ‚îÇ
              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
              ‚îÇ                                       ‚îÇ
              ‚îÇ  intake-analysis (Cloud Run)          ‚îÇ
              ‚îÇ  ‚îú‚îÄ‚îÄ /transcribe                      ‚îÇ
              ‚îÇ  ‚îú‚îÄ‚îÄ /action-items                    ‚îÇ
              ‚îÇ  ‚îú‚îÄ‚îÄ /diagnoses                       ‚îÇ
              ‚îÇ  ‚îú‚îÄ‚îÄ /sentiment                       ‚îÇ
              ‚îÇ  ‚îî‚îÄ‚îÄ /summarize                       ‚îÇ
              ‚îÇ                                       ‚îÇ
              ‚îÇ  Google Cloud Storage                 ‚îÇ
              ‚îÇ  ‚îî‚îÄ‚îÄ intake-assessment-audio-files    ‚îÇ
              ‚îÇ                                       ‚îÇ
              ‚îÇ  Cloud SQL (MySQL)                    ‚îÇ
              ‚îÇ  ‚îî‚îÄ‚îÄ Shared database with intake-v2   ‚îÇ
              ‚îÇ                                       ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Project Structure

```
clinician-report/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                          # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                      # API routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                 # NextAuth.js authentication
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [...nextauth]/    # Auth configuration
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clinician/            # Clinician-specific endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ patients/         # Patient list & details
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route.ts      # GET /api/clinician/patients
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [id]/         # Single patient
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ search/       # Patient search
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scales/           # Assessment scales
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route.ts      # GET scales for patient
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ assign/       # Assign scales to patient
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ insights/         # AI clinical insights
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts      # Fetch action items & diagnoses
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ journal/          # Patient journal entries
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sentiment/            # Sentiment analysis trigger
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ summarize/            # Profile summarization
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transcribe/           # Transcription trigger
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audio/                # Audio file streaming
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf/                  # PDF generation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ download/         # PDF download endpoint
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ weather/              # Mood weather data
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search/                   # Patient search page
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx              # Clinician home/search
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report/                   # Patient report pages
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [patientId]/          # Dynamic patient routes
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ layout.tsx        # Report sidebar layout
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ page.tsx          # Overview page
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ scales/           # Scales page
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ journals/         # Journals page
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ treatment-plan/   # Treatment plan page
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ learn/            # Psychoeducation page
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analysis/                 # Batch analysis tools
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/               # React components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Report/               # Report-specific components
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PatientReportClient.tsx  # Main report view
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ReportHeader.tsx         # Header with actions
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PatientTopBar.tsx        # Patient info bar
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TopBlocks.tsx            # Summary blocks
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Cards.tsx                # Data cards
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DetailPanels.tsx         # Expandable panels
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RadarChart.tsx           # Scale visualization
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui.tsx                   # Shared UI elements
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AssessmentReportPDFAdult.tsx # Adult PDF template
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AssessmentReportPDFChild.tsx # Child PDF template
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ScaleDetailDrawer.tsx        # Scale breakdown
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Drawer.tsx                   # Slide-out panel
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WeatherWidget.tsx            # Mood display
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GradientText.tsx             # Styled text
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ShinyText.tsx                # Animated text
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Garden/                      # Garden components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ text.ts                      # Text constants
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ theme.ts                     # Theme configuration
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.ts                     # TypeScript types
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cx.ts                        # Class name utilities
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/                 # React contexts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProfileContext.tsx    # Global profile state
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/                      # Utilities
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma.ts             # Prisma client
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cloudrun-client.ts    # Cloud Run API client
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils.ts              # General utilities
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hooks/                # Custom hooks
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css               # Global styles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Root layout
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers.tsx             # Context providers
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middleware.ts                 # Auth middleware
‚îÇ   ‚îî‚îÄ‚îÄ assets/                       # Static assets
‚îÇ       ‚îî‚îÄ‚îÄ IP_Logo.png               # Logo
‚îÇ
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma                 # Shared database schema
‚îÇ
‚îú‚îÄ‚îÄ public/                           # Static files
‚îÇ   ‚îú‚îÄ‚îÄ bamboo-*.png                  # Garden assets
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ Dockerfile                        # Cloud Run container
‚îú‚îÄ‚îÄ package.json                      # Dependencies
‚îú‚îÄ‚îÄ tsconfig.json                     # TypeScript config
‚îú‚îÄ‚îÄ tailwind.config.ts                # Tailwind config
‚îú‚îÄ‚îÄ eslint.config.mjs                 # ESLint config
‚îú‚îÄ‚îÄ components.json                   # shadcn/ui config
‚îú‚îÄ‚îÄ next.config.ts                    # Next.js config
‚îî‚îÄ‚îÄ postcss.config.mjs                # PostCSS config
```

---

## Technology Stack

| Category           | Technology                         |
| ------------------ | ---------------------------------- |
| **Framework**      | Next.js 15 (App Router, Turbopack) |
| **Language**       | TypeScript 5                       |
| **UI Library**     | React 19                           |
| **Styling**        | Tailwind CSS 4, Framer Motion      |
| **UI Components**  | Headless UI, Radix UI              |
| **Database**       | Prisma ORM + MySQL (Cloud SQL)     |
| **Authentication** | NextAuth.js 4 (Google OAuth)       |
| **PDF Generation** | @react-pdf/renderer                |
| **Charts**         | Recharts, MUI X-Charts             |
| **Icons**          | Lucide React, Radix Icons          |
| **Animation**      | Framer Motion                      |

---

## Getting Started

### Prerequisites

- **Node.js** >= 20.0.0
- **npm** >= 9.0.0
- **MySQL** 8.0 (Cloud SQL or local)
- Access to the shared database from `intake-assessment-v2`

### Installation

```bash
# Clone the repository
git clone https://github.com/sliao2025/clinician-report.git
cd clinician-report

# Install dependencies
npm install

# Generate Prisma client
npx prisma generate
```

### Environment Variables

Create a `.env.local` file:

```env
# Database (same as intake-assessment-v2)
DATABASE_URL="mysql://user:password@host:3306/intake_db"

# NextAuth.js
NEXTAUTH_URL="http://localhost:3001"
NEXTAUTH_SECRET="your-secret-key"

# Google OAuth (clinician-specific credentials)
GOOGLE_CLIENT_ID="your-client-id"
GOOGLE_CLIENT_SECRET="your-client-secret"

# Cloud Run Services
INTAKE_ANALYSIS_URL="https://intake-analysis-xxxxx.a.run.app"

# Google Cloud Storage
GOOGLE_APPLICATION_CREDENTIALS_JSON='{"type":"service_account",...}'
GCS_BUCKET_NAME="intake-assessment-audio-files"

# Allowed Clinician Domains (comma-separated)
ALLOWED_DOMAINS="psych-nyc.com"
```

### Development

```bash
# Start development server (port 3001 to avoid conflict with intake-v2)
npm run dev -- -p 3001
```

Visit `http://localhost:3001` to view the clinician dashboard.

---

## Deployment

### Dual-Hosting Strategy

| Platform      | Purpose              | URL                                                        |
| ------------- | -------------------- | ---------------------------------------------------------- |
| **Vercel**    | Primary (Global CDN) | `https://report.psych-nyc.com`                             |
| **Cloud Run** | Backup (us-east4)    | `https://integrative-psych-clinician-report-xxx.a.run.app` |

### Git Branches

- `main` ‚Üí Production (Vercel auto-deploy)
- `backup-vercel` ‚Üí Cloud Run backup deployment

### Vercel Deployment

```bash
git push origin main
```

### Cloud Run Deployment

```bash
# Submit to Cloud Build
gcloud builds submit --config cloudbuild.yaml
```

---

## API Endpoints

### Patient Management

| Method | Endpoint                         | Description                               |
| ------ | -------------------------------- | ----------------------------------------- |
| GET    | `/api/clinician/patients`        | List all patients for logged-in clinician |
| GET    | `/api/clinician/patients/[id]`   | Get specific patient profile              |
| GET    | `/api/clinician/patients/search` | Search patients                           |

### Assessment Data

| Method | Endpoint                            | Description                  |
| ------ | ----------------------------------- | ---------------------------- |
| GET    | `/api/clinician/scales?userId=xxx`  | Get scale scores for patient |
| POST   | `/api/clinician/scales/assign`      | Assign new scales to patient |
| GET    | `/api/clinician/journal?userId=xxx` | Get journal entries          |

### AI Services

| Method | Endpoint                             | Description                       |
| ------ | ------------------------------------ | --------------------------------- |
| GET    | `/api/clinician/insights?userId=xxx` | Fetch AI action items & diagnoses |
| POST   | `/api/sentiment`                     | Trigger sentiment analysis        |
| POST   | `/api/summarize`                     | Trigger profile summarization     |
| POST   | `/api/transcribe/trigger`            | Trigger audio transcription       |

### Reports & Media

| Method | Endpoint                       | Description               |
| ------ | ------------------------------ | ------------------------- |
| GET    | `/api/pdf/download?userId=xxx` | Generate and download PDF |
| GET    | `/api/audio?fileName=xxx`      | Stream audio file         |

---

## Authentication & Authorization

### Clinician Access Control

Only authenticated users with approved email domains can access the dashboard:

```typescript
// middleware.ts
const ALLOWED_DOMAINS = ["psych-nyc.com"];

// Check user email domain
const userDomain = session.user.email?.split("@")[1];
if (!ALLOWED_DOMAINS.includes(userDomain)) {
  return NextResponse.redirect("/unauthorized");
}
```

### Role-Based Features

certain features are restricted by user role:

- **PDF Download** - Restricted to specific clinician emails
- **Treatment Plan Generation** - Available to all clinicians
- **Batch Analysis** - Admin-only access

---

## PDF Report Generation

### Adult Reports

`AssessmentReportPDFAdult.tsx` generates comprehensive PDF reports including:

- Patient demographics
- Assessment scale scores with interpretation
- Medical and psychiatric history
- Patient narrative transcriptions
- Clinician notes section

### Child Reports

`AssessmentReportPDFChild.tsx` includes additional sections for:

- Parent/guardian information
- School and developmental history
- Parent-reported behavioral scales
- Teacher collaboration notes

### Download Flow

```typescript
// PDF generation endpoint
GET /api/pdf/download?userId=xxx&isChild=true|false

// Returns:
// Content-Disposition: attachment; filename="Assessment_Report_LastName.pdf"
// Content-Type: application/pdf
```

---

## Security

### Authentication

- **Google OAuth** - Clinicians authenticate via Google Workspace
- **Domain Restriction** - Only `@psych-nyc.com` emails allowed
- **Session Tokens** - JWT-based session management

### Data Access

- **Row-Level Security** - Clinicians only see their assigned patients
- **Audit Logging** - All API calls logged with user identity
- **Encryption** - TLS 1.3 for all traffic

### HIPAA Compliance

- Patient data encrypted at rest and in transit
- Access controls and audit trails
- No PHI in logs or error messages

---

## Related Repositories

| Repository                                                                  | Description                                              |
| --------------------------------------------------------------------------- | -------------------------------------------------------- |
| [`intake-analysis`](https://github.com/sliao2025/intake-analysis)           | Backend AI services (transcription, insights, sentiment) |
| [`intake-assessment-v2`](https://github.com/sliao2025/intake-assessment-v2) | Patient-facing intake portal                             |

---

## Scripts

| Command         | Description              |
| --------------- | ------------------------ |
| `npm run dev`   | Start development server |
| `npm run build` | Build for production     |
| `npm run start` | Start production server  |
| `npm run lint`  | Run ESLint               |

---

## Component Overview

### Key Components

#### `PatientReportClient.tsx`

Main patient report view component that orchestrates all data display.

#### `TopBlocks.tsx`

Grid of summary cards showing:

- Patient demographics
- Risk indicators (suicidality, self-harm)
- Key flags (trauma history, substance use)

#### `DetailPanels.tsx`

Expandable accordion panels for detailed sections:

- Profile information
- Medical history
- Family history
- Patient story with audio

#### `RadarChart.tsx`

Recharts-based radar visualization of assessment scale scores.

#### `ScaleDetailDrawer.tsx`

Slide-out drawer showing individual scale item responses.

---

## Troubleshooting

### Common Issues

**"Unauthorized" on login**

- Verify email domain is in `ALLOWED_DOMAINS`
- Check Google OAuth configuration

**Missing patient data**

- Ensure patient completed intake on `intake-assessment-v2`
- Verify `clinician` field is set on patient's User record

**PDF generation fails**

- Check memory limits (PDF rendering is memory-intensive)
- Verify all required fonts are available

**Audio not playing**

- Check GCS bucket permissions
- Verify `GOOGLE_APPLICATION_CREDENTIALS_JSON` is set

---

## Contributing

1. Create a feature branch from `main`
2. Make changes with appropriate tests
3. Submit a pull request
4. After approval, changes auto-deploy to Vercel

---

## License

This project is proprietary software for Integrative Psychiatry. All rights reserved.

---

<p align="center">
  <sub>Built with ‚ù§Ô∏è for mental healthcare</sub>
</p>
